<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üïµÔ∏è –ò–≥—Ä–∞ –ò–º–ø–æ—Å—Ç–µ—Ä</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow-x: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #111827; color: white; }
        #root { min-height: 100vh; }
        .tap-animation:active { transform: scale(0.95); transition: transform 0.1s; }
        select { -webkit-appearance: none; appearance: none; }
        .timer-bar { transition: width 1s linear; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }
        .glitch-text { animation: glitch 0.5s infinite; text-shadow: 2px 2px #ff00ff, -2px -2px #00ffff; }
        .intro-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        @keyframes pulse-border { 0%, 100% { border-color: rgba(234, 179, 8, 0.3); } 50% { border-color: rgba(234, 179, 8, 0.8); } }
        .beta-pulse { animation: pulse-border 2s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const firebaseConfig = { apiKey: "AIzaSyAksARQdqZL1HQi2i5484V-AvFgTLHOfAo", authDomain: "imposter-game-7ff26.firebaseapp.com", databaseURL: "https://imposter-game-7ff26-default-rtdb.firebaseio.com", projectId: "imposter-game-7ff26", storageBucket: "imposter-game-7ff26.firebasestorage.app", messagingSenderId: "668394039358", appId: "1:668394039358:web:02ce1f8c8f1066d92e896f" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const Icons = {
            Users: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Refresh: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            Finger: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" /></svg>,
            Info: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Eye: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
            Spy: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" /></svg>,
            Target: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
            Back: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>,
            Lock: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>,
            Check: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" /></svg>
        };
        const getLevenshteinDistance = (a, b) => { if (a.length === 0) return b.length; if (b.length === 0) return a.length; const matrix = []; for (let i = 0; i <= b.length; i++) matrix[i] = [i]; for (let j = 0; j <= a.length; j++) matrix[0][j] = j; for (let i = 1; i <= b.length; i++) { for (let j = 1; j <= a.length; j++) { if (b.charAt(i - 1) === a.charAt(j - 1)) matrix[i][j] = matrix[i - 1][j - 1]; else matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1)); } } return matrix[b.length][a.length]; };
        const GAME_DATABASE = {
            '–ñ–∏–≤–æ—Ç–Ω—ã–µ': { easy: ['–°–æ–±–∞–∫–∞','–ö–æ—à–∫–∞','–í–æ–ª–∫','–õ–∏—Å–∞','–ú–µ–¥–≤–µ–¥—å','–ó–∞—è—Ü','–¢–∏–≥—Ä','–õ–µ–≤','–°–ª–æ–Ω','–ñ–∏—Ä–∞—Ñ','–û–±–µ–∑—å—è–Ω–∞','–ö–æ—Ä–æ–≤–∞','–°–≤–∏–Ω—å—è','–ö—É—Ä–∏—Ü–∞','–õ–æ—à–∞–¥—å','–ú—ã—à—å','–ó–º–µ—è','–õ—è–≥—É—à–∫–∞','–†—ã–±–∞','–ü–æ–ø—É–≥–∞–π'], medium: ['–ï–Ω–æ—Ç','–ë–µ–≥–µ–º–æ—Ç','–ù–æ—Å–æ—Ä–æ–≥','–õ–µ–º—É—Ä','–ë–æ–±—Ä','–ö—Ä–æ—Ç','–ö—Ä—ã—Å–∞','–ë–∞—Ä–∞–Ω','–û—Å–µ–ª','–í–µ—Ä–±–ª—é–¥','–õ–æ—Å—å','–û–ª–µ–Ω—å','–ì–µ–ø–∞—Ä–¥','–õ–µ–æ–ø–∞—Ä–¥','–†—ã—Å—å'], hard: ['–£—Ç–∫–æ–Ω–æ—Å','–õ–µ–Ω–∏–≤–µ—Ü','–ë—Ä–æ–Ω–µ–Ω–æ—Å–µ—Ü','–ú—É—Ä–∞–≤—å–µ–¥','–°–∞–ª–∞–º–∞–Ω–¥—Ä–∞','–ö–∞–ª—å–º–∞—Ä','–ú–µ–¥—É–∑–∞','–°–∫–∞—Ç','–ê–∫—Å–æ–ª–æ—Ç–ª—å','–ö–∞–ø–∏–±–∞—Ä–∞'] },
            '18+ (–í–∑—Ä–æ—Å–ª—ã–µ)': { easy: ['–ö—Ä–æ–≤–∞—Ç—å','–î—É—à','–ë–∞–Ω—è','–°—Ç—Ä–∏–ø—Ç–∏–∑','–ú–∞—Å—Å–∞–∂','–ö–ª—É–±','–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤','–ü–æ—Ü–µ–ª—É–π','–ó–∞—Å–æ—Å','–°–≤–∏–¥–∞–Ω–∏–µ','–¶–≤–µ—Ç—ã','–°–≤–µ—á–∏','–í–∏–Ω–æ','–®–∞–º–ø–∞–Ω—Å–∫–æ–µ','–û—Ç–µ–ª—å'], medium: ['–°–µ–∫—Å-—à–æ–ø','–ù–∞—Ä—É—á–Ω–∏–∫–∏','–†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã','–¢–∏–Ω–¥–µ—Ä','–ö–∞–º–∞—Å—É—Ç—Ä–∞','–ú–∞—Å–∫–∞','–û—à–µ–π–Ω–∏–∫','–ö–æ—Å—Ç—é–º','–ú–µ–¥—Å–µ—Å—Ç—Ä–∞','–ì–æ—Ä–Ω–∏—á–Ω–∞—è'], hard: ['–°–≤–∏–Ω–≥–µ—Ä—ã','–¢—Ä–æ–π–Ω–∏—á–æ–∫','–§–µ—Ç–∏—à','–õ–∞—Ç–µ–∫—Å','–®–∏–±–∞—Ä–∏','–ë–æ–Ω–¥–∞–∂','–ü–æ–ª–∏–∞–º–æ—Ä–∏—è','–§—Ä–µ–Ω–¥–∑–æ–Ω–∞'] },
            '–°–∏—Ç—É–∞—Ü–∏–∏': { easy: ['–°–≤–∞–¥—å–±–∞','–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è','–ü–æ—Ö–æ—Ä–æ–Ω—ã','–°–≤–∏–¥–∞–Ω–∏–µ','–®–∫–æ–ª–∞','–£—Ä–æ–∫','–≠–∫–∑–∞–º–µ–Ω','–†–∞–±–æ—Ç–∞','–°–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ','–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ','–û—Ç–ø—É—Å–∫','–ü–µ—Ä–µ–µ–∑–¥','–†–µ–º–æ–Ω—Ç','–£–±–æ—Ä–∫–∞','–ì–æ—Ç–æ–≤–∫–∞'], medium: ['–û–ø–æ–∑–¥–∞–ª','–ó–∞—Å—Ç—Ä—è–ª –≤ –ª–∏—Ñ—Ç–µ','–ó–∞–±—ã–ª –∫–æ—à–µ–ª–µ–∫','–í—ã–∏–≥—Ä–∞–ª','–ü–æ—Ç–µ—Ä—è–ª —Ç–µ–ª–µ—Ñ–æ–Ω','–ê—Ä–µ—Å—Ç','–°—É–¥','–¢—é—Ä—å–º–∞','–ü–æ–±–µ–≥','–û–≥—Ä–∞–±–ª–µ–Ω–∏–µ'], hard: ['–î–µ–∂–∞–≤—é','–û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π —Å–æ–Ω','–°–æ–Ω–Ω—ã–π –ø–∞—Ä–∞–ª–∏—á','–ü–∞–Ω–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞','–ì–∏–ø–Ω–æ–∑','–ú–µ–¥–∏—Ç–∞—Ü–∏—è','–ö–ª–∏–Ω–∏—á–µ—Å–∫–∞—è —Å–º–µ—Ä—Ç—å','–î–µ–Ω—å —Å—É—Ä–∫–∞'] },
            '–ö—Ä–∏–Ω–∂ –∏ –ú–µ–º—ã': { easy: ['–¢–∏–∫–¢–æ–∫','–Æ—Ç—É–±','–õ–∞–π–∫','–î–æ–Ω–∞—Ç','–•–∞–π–ø','–ö—Ä–∏–Ω–∂','–ö—Ä–∞—à','–í–∞–π–±','–ü—Ä—É—Ñ','–†–æ—Ñ–ª','–ë–ª–æ–≥–µ—Ä','–°—Ç—Ä–∏–º–µ—Ä','–®–∞—É—Ä–º–∞','–î–æ—à–∏—Ä–∞–∫','–ê–π—Ñ–æ–Ω'], medium: ['–°–∫—É—Ñ','–ê–ª—å—Ç—É—à–∫–∞','–°–∏–≥–º–∞','–ì–∏–≥–∞—á–∞–¥','–°–∏–º–ø','–î—É—à–Ω–∏–ª–∞','–¢–æ–∫—Å–∏–∫','–ê–±—å—é–∑–µ—Ä','–ì–∞–∑–ª–∞–π—Ç–µ—Ä','–†–µ–¥ —Ñ–ª–∞–≥'], hard: ['–ü–ª–æ—Å–∫–∞—è –ó–µ–º–ª—è','–†–µ–ø—Ç–∏–ª–æ–∏–¥—ã','–ú–∞—Å–æ–Ω—ã','–ò–ª–ª—é–º–∏–Ω–∞—Ç—ã','–ò–Ω—Ñ–æ—Ü—ã–≥–∞–Ω','–ö–æ—É—á','–ú–∞—Ä–∞—Ñ–æ–Ω','–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å'] },
            '–ï–¥–∞': { easy: ['–•–ª–µ–±','–Ø–±–ª–æ–∫–æ','–ë–∞–Ω–∞–Ω','–ê—Ä–±—É–∑','–ü–æ–º–∏–¥–æ—Ä','–û–≥—É—Ä–µ—Ü','–ö–∞—Ä—Ç–æ—à–∫–∞','–Ø–π—Ü–æ','–ú–æ–ª–æ–∫–æ','–°—ã—Ä','–ö–æ–ª–±–∞—Å–∞','–ö—É—Ä–∏—Ü–∞','–ú—è—Å–æ','–†—ã–±–∞','–ü–∏—Ü—Ü–∞','–ë—É—Ä–≥–µ—Ä','–°—É—à–∏','–¢–æ—Ä—Ç','–ú–æ—Ä–æ–∂–µ–Ω–æ–µ','–®–æ–∫–æ–ª–∞–¥'], medium: ['–ë–æ—Ä—â','–©–∏','–ü–µ–ª—å–º–µ–Ω–∏','–®–∞—à–ª—ã–∫','–ü–ª–æ–≤','–ú–∞–∫–∞—Ä–æ–Ω—ã','–°–ø–∞–≥–µ—Ç—Ç–∏','–õ–∞–∑–∞–Ω—å—è','–ë–ª–∏–Ω—ã','–û–ª–∞–¥—å–∏'], hard: ['–§—É–∞-–≥—Ä–∞','–¢—Ä—é—Ñ–µ–ª—å','–£—Å—Ç—Ä–∏—Ü—ã','–•–∞–º–æ–Ω','–ü–∞—Ä–º–µ–∑–∞–Ω','–¢–∏—Ä–∞–º–∏—Å—É','–ß–∏–∑–∫–µ–π–∫','–ö—Ä—É–∞—Å—Å–∞–Ω'] },
            '–ú–∏—Ä': { easy: ['–†–æ—Å—Å–∏—è','–°–®–ê','–ö–∏—Ç–∞–π','–§—Ä–∞–Ω—Ü–∏—è','–ì–µ—Ä–º–∞–Ω–∏—è','–ò—Ç–∞–ª–∏—è','–ò—Å–ø–∞–Ω–∏—è','–ê–Ω–≥–ª–∏—è','–Ø–ø–æ–Ω–∏—è','–¢—É—Ä—Ü–∏—è','–ï–≥–∏–ø–µ—Ç','–ú–æ—Å–∫–≤–∞','–õ–æ–Ω–¥–æ–Ω','–ü–∞—Ä–∏–∂','–ù—å—é-–ô–æ—Ä–∫'], medium: ['–ë—Ä–∞–∑–∏–ª–∏—è','–ö–∞–Ω–∞–¥–∞','–ê–≤—Å—Ç—Ä–∞–ª–∏—è','–ò–Ω–¥–∏—è','–ú–µ–∫—Å–∏–∫–∞','–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞','–ì—Ä–µ—Ü–∏—è','–í—å–µ—Ç–Ω–∞–º','–ö–æ—Ä–µ—è','–£–∫—Ä–∞–∏–Ω–∞'], hard: ['–í–∞—Ç–∏–∫–∞–Ω','–ú–æ–Ω–∞–∫–æ','–õ—é–∫—Å–µ–º–±—É—Ä–≥','–®–≤–µ–π—Ü–∞—Ä–∏—è','–ò—Å–ª–∞–Ω–¥–∏—è','–°–µ–≤–µ—Ä–Ω–∞—è –ö–æ—Ä–µ—è','–ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–∞','–ì—Ä–µ–Ω–ª–∞–Ω–¥–∏—è'] },
            '–†–∞–±–æ—Ç–∞ –∏ –•–æ–±–±–∏': { easy: ['–í—Ä–∞—á','–£—á–∏—Ç–µ–ª—å','–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π','–ü–æ–∂–∞—Ä–Ω—ã–π','–í–æ–¥–∏—Ç–µ–ª—å','–ü–æ–≤–∞—Ä','–ü—Ä–æ–¥–∞–≤–µ—Ü','–°—Ç—Ä–æ–∏—Ç–µ–ª—å','–•—É–¥–æ–∂–Ω–∏–∫','–ü–µ–≤–µ—Ü','–ê–∫—Ç–µ—Ä','–§—É—Ç–±–æ–ª–∏—Å—Ç','–ë–ª–æ–≥–µ—Ä','–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç','–ö–æ—Å–º–æ–Ω–∞–≤—Ç'], medium: ['–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç','–Æ—Ä–∏—Å—Ç','–ë—É—Ö–≥–∞–ª—Ç–µ—Ä','–ú–µ–Ω–µ–¥–∂–µ—Ä','–î–∏—Ä–µ–∫—Ç–æ—Ä','–ë–∏–∑–Ω–µ—Å–º–µ–Ω','–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥','–•–∏—Ä—É—Ä–≥','–ü—Å–∏—Ö–æ–ª–æ–≥','–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä'], hard: ['–ü–∞—Ç–æ–ª–æ–≥–æ–∞–Ω–∞—Ç–æ–º','–ì—Ä–æ–±–æ–≤—â–∏–∫','–ö–∏–ª–ª–µ—Ä','–®–ø–∏–æ–Ω','–•–∞–∫–µ—Ä','–ú–∞–π–Ω–µ—Ä','–ê—Å—Ç—Ä–æ–Ω–æ–º','–ê—Ä—Ö–µ–æ–ª–æ–≥'] },
            '–¢–µ—Ö–Ω–∏–∫–∞': { easy: ['–ú–∞—à–∏–Ω–∞','–ê–≤—Ç–æ–±—É—Å','–ü–æ–µ–∑–¥','–°–∞–º–æ–ª–µ—Ç','–í–µ–ª–æ—Å–∏–ø–µ–¥','–ú–æ—Ç–æ—Ü–∏–∫–ª','–¢–∞–∫—Å–∏','–ú–µ—Ç—Ä–æ','–¢–µ–ª–µ—Ñ–æ–Ω','–ö–æ–º–ø—å—é—Ç–µ—Ä','–¢–µ–ª–µ–≤–∏–∑–æ—Ä','–ß–∞—Å—ã','–ù–∞—É—à–Ω–∏–∫–∏','–ö–æ–ª–æ–Ω–∫–∞','–ü–ª–∞–Ω—à–µ—Ç'], medium: ['–ì—Ä—É–∑–æ–≤–∏–∫','–¢—Ä–∞–∫—Ç–æ—Ä','–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä','–ö—Ä–∞–Ω','–¢–∞–Ω–∫','–í–µ—Ä—Ç–æ–ª–µ—Ç','–†–∞–∫–µ—Ç–∞','–ö–æ—Ä–∞–±–ª—å','–õ–æ–¥–∫–∞','–Ø—Ö—Ç–∞'], hard: ['–ü–æ–¥–≤–æ–¥–Ω–∞—è –ª–æ–¥–∫–∞','–î–∏—Ä–∏–∂–∞–±–ª—å','–°–ø—É—Ç–Ω–∏–∫','–ú–ö–°','–õ—É–Ω–æ—Ö–æ–¥','–ú–∞—Ä—Å–æ—Ö–æ–¥','–ú–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏'] },
            '‚úèÔ∏è –°–≤–æ—ë —Å–ª–æ–≤–æ (–ë–ï–¢–ê)': { isCustom: true, easy: [], medium: [], hard: [] }
        };
        const IntroScreen = ({ onComplete }) => { useEffect(() => { const timer = setTimeout(() => onComplete(), 2500); return () => clearTimeout(timer); }, []); return (<div className="intro-container"><h1 className="text-6xl md:text-8xl font-black text-white glitch-text tracking-wider">IMPOSTOR</h1><p className="text-gray-400 mt-4 tracking-[0.5em] animate-pulse">DETECT OR DECEIVE</p></div>); };
        const RulesModal = ({ onClose }) => (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"><div className="bg-gray-800 rounded-2xl p-6 max-w-sm w-full border border-purple-500/30 shadow-2xl max-h-[80vh] overflow-y-auto"><h2 className="text-2xl font-bold mb-4 text-purple-400">üìú –ü—Ä–∞–≤–∏–ª–∞</h2><ul className="space-y-3 text-gray-300 text-sm list-disc pl-5"><li><strong>–†–æ–ª–∏:</strong> –ú–∏—Ä–Ω—ã–µ –∏ –®–ø–∏–æ–Ω(—ã).</li><li><strong>–ú–∏—Ä–Ω—ã–µ:</strong> –ó–Ω–∞—é—Ç —Å–ª–æ–≤–æ. –ò—â—É—Ç –®–ø–∏–æ–Ω–∞.</li><li><strong>–®–ø–∏–æ–Ω:</strong> –í–∏–¥–∏—Ç "–°–ö–†–´–¢–û". –£–≥–∞–¥—ã–≤–∞–µ—Ç —Å–ª–æ–≤–æ.</li><li><strong>–ü–æ–±–µ–¥–∞ –®–ø–∏–æ–Ω–∞:</strong> –£–≥–∞–¥–∞—Ç—å —Å–ª–æ–≤–æ (1 –æ–ø–µ—á–∞—Ç–∫–∞ –û–ö)!</li><li className="text-yellow-400"><strong>–°–≤–æ—ë —Å–ª–æ–≤–æ:</strong> –í—Å–µ –ø–∏—à—É—Ç ‚Üí —Ä–æ–ª–∏ ‚Üí –º–∏—Ä–Ω—ã–µ –≥–æ–ª–æ—Å—É—é—Ç (—à–ø–∏–æ–Ω –Ω–µ –≤–∏–¥–∏—Ç) ‚Üí –∏–≥—Ä–∞!</li></ul><button onClick={onClose} className="mt-6 w-full bg-purple-600 hover:bg-purple-700 py-3 rounded-xl font-bold tap-animation text-white">–ü–æ–Ω—è—Ç–Ω–æ!</button></div></div>);
        const BettingModal = ({ players, onClose, onBet, myPlayerId }) => (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm"><div className="bg-gray-800 rounded-2xl p-6 max-w-sm w-full border border-pink-500/50 shadow-2xl"><h2 className="text-2xl font-bold mb-4 text-pink-400 text-center">üéØ –¢–≤–æ—è —Å—Ç–∞–≤–∫–∞</h2><div className="grid grid-cols-2 gap-3 mb-4">{players.filter(p => p.id !== myPlayerId && !p.isDead).map(p => (<button key={p.id} onClick={() => onBet(p.id)} className="bg-gray-700 p-3 rounded-lg hover:bg-pink-600/50 transition-colors text-white font-bold">{p.name}</button>))}</div><button onClick={onClose} className="w-full bg-gray-600 hover:bg-gray-500 py-3 rounded-xl font-bold text-white">–û—Ç–º–µ–Ω–∞</button></div></div>);
        const GuessWordModal = ({ onClose, onGuess }) => { const [guess, setGuess] = useState(''); return (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm"><div className="bg-gray-800 rounded-2xl p-6 max-w-sm w-full border border-yellow-500/50 shadow-2xl"><h2 className="text-2xl font-bold mb-2 text-yellow-400 text-center">üïµÔ∏è –®–ø–∏–æ–Ω, —Ä–∏—Å–∫–Ω–µ—à—å?</h2><input type="text" autoFocus placeholder="–ù–∞–ø–∏—à–∏ —Å–ª–æ–≤–æ..." value={guess} onChange={e => setGuess(e.target.value)} className="w-full bg-gray-900 text-white p-4 rounded-xl outline-none border border-gray-700 focus:border-yellow-500 mb-4 text-center text-xl" /><div className="flex gap-2"><button onClick={onClose} className="flex-1 bg-gray-700 hover:bg-gray-600 py-3 rounded-xl font-bold text-gray-300">–û—Ç–º–µ–Ω–∞</button><button onClick={() => onGuess(guess)} className="flex-1 bg-yellow-600 hover:bg-yellow-700 py-3 rounded-xl font-bold text-black tap-animation">–£–≥–∞–¥–∞—Ç—å!</button></div></div></div>); };
        const ImpostorGame = () => {
            const [showIntro, setShowIntro] = useState(true);
            const [screen, setScreen] = useState('home');
            const [roomCode, setRoomCode] = useState('');
            const [playerName, setPlayerName] = useState('');
            const [myPlayerId, setMyPlayerId] = useState('');
            const [players, setPlayers] = useState([]);
            const [isHost, setIsHost] = useState(false);
            const [showRules, setShowRules] = useState(false);
            const [showGuessModal, setShowGuessModal] = useState(false);
            const [showBetModal, setShowBetModal] = useState(false);
            const [gameState, setGameState] = useState({});
            const [selectedTheme, setSelectedTheme] = useState('–ñ–∏–≤–æ—Ç–Ω—ã–µ');
            const [difficulty, setDifficulty] = useState('mix');
            const [voteTarget, setVoteTarget] = useState(null);
            const [countdown, setCountdown] = useState(10);
            const [meetingCooldown, setMeetingCooldown] = useState(0);
            const [impostorCount, setImpostorCount] = useState(1);
            const [customWord, setCustomWord] = useState('');
            const [hasSubmittedWord, setHasSubmittedWord] = useState(false);
            const [wordVote, setWordVote] = useState(null);
            const [selectionMethodVote, setSelectionMethodVote] = useState(null);
            const myRole = useMemo(() => gameState?.players?.[myPlayerId]?.role || null, [gameState, myPlayerId]);
            const isDead = useMemo(() => gameState?.players?.[myPlayerId]?.isDead === true, [gameState, myPlayerId]);
            const isImpostor = useMemo(() => myRole === 'impostor', [myRole]);
            useEffect(() => {
                if (roomCode && myPlayerId) {
                    const roomRef = database.ref(`rooms/${roomCode}`);
                    roomRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            if (data.players) setPlayers(Object.entries(data.players).map(([id, p]) => ({ id, ...p })));
                            if (data.host === myPlayerId) setIsHost(true);
                            if (data.game) {
                                setGameState(data.game);
                                const ph = data.game.phase;
                                if (ph === 'LOBBY') { setVoteTarget(null); setShowGuessModal(false); setShowBetModal(false); setCustomWord(''); setHasSubmittedWord(false); setWordVote(null); setSelectionMethodVote(null); }
                                if (ph === 'CUSTOM_WORD_INPUT') setScreen('customWordInput');
                                else if (ph === 'SELECTION_METHOD_VOTE') setScreen('selectionMethodVote');
                                else if (ph === 'CUSTOM_WORD_VOTE') setScreen('customWordVote');
                                else if (ph === 'WORD_SELECT') setScreen('wordSelect');
                                else if (ph === 'PLAYING') { setVoteTarget(null); if (screen !== 'game') setMeetingCooldown(5); setScreen('game'); }
                                else if (ph === 'VOTING') setScreen('voting');
                                else if (ph === 'GAME_OVER') setScreen('gameOver');
                                else setScreen('lobby');
                            }
                        } else setScreen('home');
                    });
                    return () => roomRef.off();
                }
            }, [roomCode, myPlayerId]);
            useEffect(() => { let timerInterval; if (screen === 'wordSelect') { setCountdown(10); timerInterval = setInterval(() => { setCountdown(prev => { if (prev <= 1) { clearInterval(timerInterval); if (isHost) database.ref(`rooms/${roomCode}/game/phase`).set('PLAYING'); return 0; } return prev - 1; }); }, 1000); } return () => clearInterval(timerInterval); }, [screen, isHost, roomCode]);
            useEffect(() => { let cdInterval; if (meetingCooldown > 0) cdInterval = setInterval(() => setMeetingCooldown(prev => prev - 1), 1000); return () => clearInterval(cdInterval); }, [meetingCooldown]);
            const createRoom = async () => { if (!playerName) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!'); const code = Math.floor(1000 + Math.random() * 9000).toString(); const pid = Date.now().toString(); await database.ref(`rooms/${code}`).set({ host: pid, created: Date.now(), players: { [pid]: { name: playerName, isDead: false } }, game: { phase: 'LOBBY' } }); setRoomCode(code); setMyPlayerId(pid); setIsHost(true); setScreen('lobby'); };
            const joinRoom = async () => { if (!playerName || !roomCode) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!'); const roomRef = database.ref(`rooms/${roomCode}`); const snap = await roomRef.once('value'); if (!snap.exists()) return alert('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'); const roomData = snap.val(); if (roomData.game?.phase !== 'LOBBY') return alert('–ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç'); if (Object.values(roomData.players || {}).some(p => p.name.trim().toLowerCase() === playerName.trim().toLowerCase())) return alert('–ò–º—è –∑–∞–Ω—è—Ç–æ!'); const pid = Date.now().toString(); await roomRef.child(`players/${pid}`).set({ name: playerName, isDead: false }); setMyPlayerId(pid); setScreen('lobby'); };
            const startGameSetup = async () => {
                if (!selectedTheme) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É');
                if (players.length < 2) return alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞!');
                const maxImpostors = Math.floor(players.length / 2);
                const actualImpostorCount = Math.min(impostorCount, maxImpostors);
                if (actualImpostorCount < 1) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–∫–æ–≤!');
                try {
                    if (GAME_DATABASE[selectedTheme]?.isCustom) {
                        await database.ref(`rooms/${roomCode}/game`).set({ phase: 'CUSTOM_WORD_INPUT', theme: selectedTheme, customWords: {}, impostorCount: actualImpostorCount, impostorIds: [], players: {}, bets: {}, votes: null });
                    } else {
                        const themeData = GAME_DATABASE[selectedTheme];
                        let wordsPool = difficulty === 'mix' ? [...themeData.easy, ...themeData.medium, ...themeData.hard] : (themeData[difficulty] || themeData.easy);
                        const word = wordsPool[Math.floor(Math.random() * wordsPool.length)];
                        const shuffledPlayers = [...players].sort(() => Math.random() - 0.5);
                        const impostorIds = shuffledPlayers.slice(0, actualImpostorCount).map(p => p.id);
                        const gamePlayers = {};
                        players.forEach(p => gamePlayers[p.id] = { role: impostorIds.includes(p.id) ? 'impostor' : 'civilian', isDead: false });
                        await database.ref(`rooms/${roomCode}/game`).set({ phase: 'WORD_SELECT', theme: selectedTheme, difficulty, currentWord: word, impostorIds, impostorId: impostorIds[0], impostorCount: actualImpostorCount, players: gamePlayers, bets: {}, votes: null });
                    }
                } catch (error) { alert("–û—à–∏–±–∫–∞: " + error.message); }
            };
            const submitCustomWord = async () => {
                if (!customWord.trim()) return alert('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ!');
                await database.ref(`rooms/${roomCode}/game/customWords/${myPlayerId}`).set({ word: customWord.trim(), playerName });
                setHasSubmittedWord(true);
                const snap = await database.ref(`rooms/${roomCode}/game/customWords`).once('value');
                const words = snap.val() || {};
                if (Object.keys(words).length >= players.length && isHost) {
                    const gameSnap = await database.ref(`rooms/${roomCode}/game`).once('value');
                    const currentGame = gameSnap.val();
                    const actualImpostorCount = currentGame.impostorCount || 1;
                    const shuffledPlayers = [...players].sort(() => Math.random() - 0.5);
                    const impostorIds = shuffledPlayers.slice(0, actualImpostorCount).map(p => p.id);
                    const gamePlayers = {};
                    players.forEach(p => gamePlayers[p.id] = { role: impostorIds.includes(p.id) ? 'impostor' : 'civilian', isDead: false });
                    await database.ref(`rooms/${roomCode}/game`).update({ phase: 'SELECTION_METHOD_VOTE', impostorIds, impostorId: impostorIds[0], players: gamePlayers, selectionMethodVotes: {} });
                }
            };
            const submitSelectionMethodVote = async (method) => {
                setSelectionMethodVote(method);
                await database.ref(`rooms/${roomCode}/game/selectionMethodVotes/${myPlayerId}`).set(method);
                const snap = await database.ref(`rooms/${roomCode}/game/selectionMethodVotes`).once('value');
                const votes = snap.val() || {};
                if (Object.keys(votes).length >= players.length && isHost) {
                    let randomVotes = 0, voteVotes = 0;
                    Object.values(votes).forEach(v => { if (v === 'random') randomVotes++; else voteVotes++; });
                    let selectedMethod = randomVotes > voteVotes ? 'random' : voteVotes > randomVotes ? 'vote' : (Math.random() < 0.5 ? 'random' : 'vote');
                    if (selectedMethod === 'random') {
                        const wordsSnap = await database.ref(`rooms/${roomCode}/game/customWords`).once('value');
                        const allWords = wordsSnap.val() || {};
                        const gameSnap = await database.ref(`rooms/${roomCode}/game`).once('value');
                        const currentGame = gameSnap.val();
                        const impostorIds = currentGame.impostorIds || [currentGame.impostorId];
                        const civilianWords = Object.entries(allWords).filter(([pid]) => !impostorIds.includes(pid)).map(([, data]) => data.word);
                        const selectedWord = civilianWords.length > 0 ? civilianWords[Math.floor(Math.random() * civilianWords.length)] : Object.values(allWords)[0]?.word;
                        await database.ref(`rooms/${roomCode}/game`).update({ phase: 'WORD_SELECT', currentWord: selectedWord, selectionMethod: 'random' });
                    } else {
                        await database.ref(`rooms/${roomCode}/game`).update({ phase: 'CUSTOM_WORD_VOTE', wordVotes: {}, selectionMethod: 'vote' });
                    }
                }
            };
            const submitWordVote = async (wordIndex) => {
                setWordVote(wordIndex);
                await database.ref(`rooms/${roomCode}/game/wordVotes/${myPlayerId}`).set({ wordIndex, isImpostor });
                const snap = await database.ref(`rooms/${roomCode}/game/wordVotes`).once('value');
                const votes = snap.val() || {};
                if (Object.keys(votes).length >= players.length && isHost) {
                    const wordsSnap = await database.ref(`rooms/${roomCode}/game/customWords`).once('value');
                    const allWords = wordsSnap.val() || {};
                    const gameSnap = await database.ref(`rooms/${roomCode}/game`).once('value');
                    const currentGame = gameSnap.val();
                    const impostorIds = currentGame.impostorIds || [currentGame.impostorId];
                    const civilianWordEntries = Object.entries(allWords).filter(([pid]) => !impostorIds.includes(pid));
                    const tallies = {};
                    Object.entries(votes).forEach(([voterId, voteData]) => { if (!voteData.isImpostor) tallies[voteData.wordIndex] = (tallies[voteData.wordIndex] || 0) + 1; });
                    let maxVotes = 0, winners = [];
                    Object.entries(tallies).forEach(([idx, count]) => { if (count > maxVotes) { maxVotes = count; winners = [parseInt(idx)]; } else if (count === maxVotes) winners.push(parseInt(idx)); });
                    const winnerIdx = winners.length > 0 ? winners[Math.floor(Math.random() * winners.length)] : 0;
                    const selectedWord = civilianWordEntries[winnerIdx]?.[1]?.word || civilianWordEntries[0]?.[1]?.word || '–°–ª–æ–≤–æ';
                    await database.ref(`rooms/${roomCode}/game`).update({ phase: 'WORD_SELECT', currentWord: selectedWord });
                }
            };
            const changeWord = async () => { if (countdown <= 0 || GAME_DATABASE[gameState.theme]?.isCustom) return; const themeData = GAME_DATABASE[gameState.theme]; let wordsPool = (!gameState.difficulty || gameState.difficulty === 'mix') ? [...themeData.easy, ...themeData.medium, ...themeData.hard] : themeData[gameState.difficulty]; await database.ref(`rooms/${roomCode}/game/currentWord`).set(wordsPool[Math.floor(Math.random() * wordsPool.length)]); };
            const handleSpyGuess = async (guess) => { if (!guess.trim()) return; const dist = getLevenshteinDistance(guess.trim().toLowerCase(), gameState.currentWord.trim().toLowerCase()); await database.ref(`rooms/${roomCode}/game`).update({ phase: 'GAME_OVER', winner: dist <= 1 ? 'impostor' : 'civilians', endReason: dist <= 1 ? 'spy_guessed' : 'spy_failed_guess' }); setShowGuessModal(false); };
            const placeBet = async (targetId) => { await database.ref(`rooms/${roomCode}/game/bets/${myPlayerId}`).set(targetId); setShowBetModal(false); };
            const callVote = async () => { if (meetingCooldown > 0) return; await database.ref(`rooms/${roomCode}/game`).update({ phase: 'VOTING', votes: {} }); };
            const cancelVote = async () => { await database.ref(`rooms/${roomCode}/game`).update({ phase: 'PLAYING', votes: null }); };
            const submitVote = async (targetId) => {
                if (isDead) return;
                setVoteTarget(targetId);
                await database.ref(`rooms/${roomCode}/game/votes/${myPlayerId}`).set(targetId);
                const gSnap = await database.ref(`rooms/${roomCode}/game`).once('value');
                const gData = gSnap.val();
                const aliveCount = Object.values(gData.players).filter(p => !p.isDead).length;
                const voteCount = Object.keys(gData.votes || {}).length;
                if (voteCount >= aliveCount && isHost) processVotingResult(gData.votes, gData.players, gData);
            };
            const processVotingResult = async (votes, gamePlayers, gData) => {
                const tallies = {};
                Object.values(votes).forEach(target => tallies[target] = (tallies[target] || 0) + 1);
                let maxVotes = 0, candidate = null;
                Object.entries(tallies).forEach(([pid, count]) => { if (count > maxVotes) { maxVotes = count; candidate = pid; } });
                if (candidate) {
                    const victimRole = gamePlayers[candidate].role;
                    const impostorIds = gData.impostorIds || [gData.impostorId];
                    if (victimRole === 'impostor') {
                        const remainingImpostors = impostorIds.filter(id => id !== candidate && !gamePlayers[id]?.isDead);
                        if (remainingImpostors.length === 0) {
                            await database.ref(`rooms/${roomCode}/game`).update({ phase: 'GAME_OVER', winner: 'civilians', ejected: candidate });
                        } else {
                            await database.ref(`rooms/${roomCode}/game/players/${candidate}`).update({ isDead: true });
                            await database.ref(`rooms/${roomCode}/game`).update({ phase: 'PLAYING', votes: null, lastEjected: { name: players.find(p => p.id === candidate)?.name, role: 'impostor' } });
                        }
                    } else {
                        await database.ref(`rooms/${roomCode}/game/players/${candidate}`).update({ isDead: true });
                        const aliveNow = Object.values(gamePlayers).filter(p => !p.isDead).length - 1;
                        const aliveImpostors = impostorIds.filter(id => !gamePlayers[id]?.isDead).length;
                        if (aliveNow <= aliveImpostors * 2) await database.ref(`rooms/${roomCode}/game`).update({ phase: 'GAME_OVER', winner: 'impostor', ejected: candidate });
                        else await database.ref(`rooms/${roomCode}/game`).update({ phase: 'PLAYING', votes: null, lastEjected: { name: players.find(p => p.id === candidate)?.name, role: 'civilian' } });
                    }
                } else await database.ref(`rooms/${roomCode}/game`).update({ phase: 'PLAYING', votes: null });
            };
            const playAgain = async () => { setCustomWord(''); setHasSubmittedWord(false); setWordVote(null); setSelectionMethodVote(null); await database.ref(`rooms/${roomCode}/game`).set({ phase: 'LOBBY' }); };
            if (showIntro) return <IntroScreen onComplete={() => setShowIntro(false)} />;
            const customWords = gameState.customWords || {};
            const impostorIds = gameState.impostorIds || [gameState.impostorId];
            const civilianWordEntries = Object.entries(customWords).filter(([pid]) => !impostorIds.includes(pid));
            const allWordEntries = Object.entries(customWords);
            return (
                <div className="min-h-screen relative">
                    {showRules && <RulesModal onClose={() => setShowRules(false)} />}
                    {showGuessModal && <GuessWordModal onClose={() => setShowGuessModal(false)} onGuess={handleSpyGuess} />}
                    {showBetModal && <BettingModal players={players} onClose={() => setShowBetModal(false)} onBet={placeBet} myPlayerId={myPlayerId} />}
                    <div className="absolute top-4 right-4 z-10"><button onClick={() => setShowRules(true)} className="p-2 bg-gray-700 rounded-full text-gray-300 hover:bg-gray-600 shadow-lg"><Icons.Info /></button></div>

                    {screen === 'home' && (
                        <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gray-900">
                            <h1 className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2">IMPOSTOR</h1>
                            <p className="text-gray-400 mb-8">–ù–∞–π–¥–∏ —à–ø–∏–æ–Ω–∞ –∏–ª–∏ –æ–±–º–∞–Ω–∏ –≤—Å–µ—Ö</p>
                            <div className="w-full max-w-sm space-y-4">
                                <input type="text" placeholder="–¢–≤–æ–µ –∏–º—è" value={playerName} onChange={e => setPlayerName(e.target.value)} className="w-full bg-gray-800 text-white px-4 py-4 rounded-xl outline-none focus:ring-2 focus:ring-purple-500 text-lg" />
                                <button onClick={createRoom} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-xl tap-animation shadow-lg">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                                <div className="flex gap-2">
                                    <input type="number" placeholder="0000" value={roomCode} onChange={e => setRoomCode(e.target.value.slice(0, 4))} className="w-1/3 bg-gray-800 text-white px-4 py-4 rounded-xl outline-none text-center font-mono text-xl" />
                                    <button onClick={joinRoom} className="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 rounded-xl tap-animation">–í–æ–π—Ç–∏</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {screen === 'lobby' && (
                        <div className="min-h-screen bg-gray-900 p-6 pt-16 pb-64">
                            <div className="bg-gray-800 rounded-2xl p-6 mb-6"><div className="text-gray-400 text-sm uppercase tracking-wider mb-1">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã</div><div className="text-4xl font-mono font-bold text-white tracking-widest">{roomCode}</div></div>
                            <div className="space-y-3 mb-8"><h3 className="text-white font-bold flex items-center gap-2"><Icons.Users /> –ò–≥—Ä–æ–∫–∏ ({players.length})</h3>{players.map(p => (<div key={p.id} className="bg-gray-700 p-3 rounded-xl flex items-center justify-between text-white"><span>{p.name}</span>{p.id === gameState.host && <span className="text-xs bg-yellow-500 text-black px-2 py-1 rounded">Host</span>}</div>))}</div>
                            {isHost ? (
                                <div className="fixed bottom-6 left-6 right-6 space-y-3 bg-gray-900 pt-2 pb-6 border-t border-gray-800">
                                    <div className="flex gap-2 mb-2"><select value={selectedTheme} onChange={e => setSelectedTheme(e.target.value)} className="w-2/3 bg-gray-800 text-white p-4 rounded-xl outline-none border border-gray-700 text-lg">{Object.keys(GAME_DATABASE).map(t => <option key={t} value={t}>{t}</option>)}</select><select value={difficulty} onChange={e => setDifficulty(e.target.value)} className="w-1/3 bg-gray-800 text-white p-4 rounded-xl outline-none border border-gray-700 text-lg" disabled={GAME_DATABASE[selectedTheme]?.isCustom}><option value="easy">Easy</option><option value="medium">Norm</option><option value="hard">Hard</option><option value="mix">Mix</option></select></div>
                                    <div className="flex items-center gap-3 bg-gray-800 p-3 rounded-xl border border-gray-700"><span className="text-gray-400 text-sm">üïµÔ∏è –ò–º–ø–æ—Å—Ç–µ—Ä–æ–≤:</span><div className="flex gap-2 flex-1 justify-end">{[1, 2, 3].map(num => (<button key={num} onClick={() => setImpostorCount(num)} disabled={num > Math.floor(players.length / 2)} className={`px-4 py-2 rounded-lg font-bold transition-all ${impostorCount === num ? 'bg-red-600 text-white' : num > Math.floor(players.length / 2) ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}>{num}</button>))}</div></div>
                                    <button onClick={startGameSetup} className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl tap-animation">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                                </div>
                            ) : <div className="text-center text-gray-500 mt-10 animate-pulse">–û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞...</div>}
                        </div>
                    )}
                    {screen === 'customWordInput' && (
                        <div className="min-h-screen bg-gray-900 flex flex-col p-6 pt-12">
                            <div className="text-center mb-8"><div className="inline-block px-4 py-2 rounded-full bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 text-sm font-bold uppercase tracking-widest mb-4 beta-pulse">–ë–ï–¢–ê</div><h2 className="text-3xl font-bold text-white mb-2">‚úèÔ∏è –ù–∞–ø–∏—à–∏ —Å–≤–æ—ë —Å–ª–æ–≤–æ</h2><p className="text-gray-400">–í—Å–µ –ø–∏—à—É—Ç —Å–ª–æ–≤–∞, –ø–æ—Ç–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</p></div>
                            <div className="flex-1 flex flex-col justify-center items-center">
                                {!hasSubmittedWord ? (<div className="w-full max-w-sm space-y-4"><input type="text" placeholder="–í–≤–µ–¥–∏ —Å–ª–æ–≤–æ..." value={customWord} onChange={e => setCustomWord(e.target.value)} className="w-full bg-gray-800 text-white p-4 rounded-xl outline-none border border-gray-700 focus:border-purple-500 text-center text-xl" autoFocus /><button onClick={submitCustomWord} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-xl tap-animation flex items-center justify-center gap-2"><Icons.Check /> –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>) : (<div className="text-center"><div className="text-6xl mb-4">‚úÖ</div><h3 className="text-2xl font-bold text-green-400 mb-2">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</h3><p className="text-gray-400">–û–∂–∏–¥–∞–Ω–∏–µ...</p></div>)}
                            </div>
                            <div className="mt-8 bg-gray-800 rounded-xl p-4"><h3 className="text-sm text-gray-400 uppercase mb-3">–ù–∞–ø–∏—Å–∞–ª–∏:</h3><div className="flex flex-wrap gap-2">{players.map(p => <div key={p.id} className={`px-3 py-1 rounded-full text-sm ${customWords[p.id] ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-400'}`}>{p.name} {customWords[p.id] ? '‚úì' : '...'}</div>)}</div></div>
                        </div>
                    )}

                    {screen === 'selectionMethodVote' && (
                        <div className="min-h-screen bg-gray-900 flex flex-col p-6 pt-12">
                            <div className="text-center mb-8"><h2 className="text-3xl font-bold text-white mb-2">üé≤ –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Å–ª–æ–≤–æ?</h2><p className="text-gray-400">–ì–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –º–µ—Ç–æ–¥</p><div className={`mt-4 inline-block px-4 py-2 rounded-xl ${isImpostor ? 'bg-red-900/50 border border-red-500' : 'bg-blue-900/50 border border-blue-500'}`}>{isImpostor ? <span className="text-red-400 font-bold">üïµÔ∏è –¢—ã –®–ü–ò–û–ù!</span> : <span className="text-blue-400 font-bold">üë§ –¢—ã –ú–ò–†–ù–´–ô</span>}</div></div>
                            <div className="flex-1 flex flex-col justify-center items-center">
                                {!selectionMethodVote ? (<div className="w-full max-w-sm space-y-4"><button onClick={() => submitSelectionMethodVote('random')} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-6 rounded-xl tap-animation flex items-center justify-center gap-3 text-xl"><Icons.Refresh /> –°–ª—É—á–∞–π–Ω–æ</button><button onClick={() => submitSelectionMethodVote('vote')} className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-6 rounded-xl tap-animation flex items-center justify-center gap-3 text-xl"><Icons.Users /> –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ–º</button></div>) : (<div className="text-center"><div className="text-6xl mb-4">üó≥Ô∏è</div><h3 className="text-2xl font-bold text-green-400 mb-2">–£—á—Ç–µ–Ω–æ!</h3><p className="text-gray-400">{selectionMethodVote === 'random' ? 'üé≤ –°–ª—É—á–∞–π–Ω–æ' : 'üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ'}</p></div>)}
                            </div>
                            <div className="mt-8 bg-gray-800 rounded-xl p-4"><h3 className="text-sm text-gray-400 uppercase mb-3">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏:</h3><div className="flex flex-wrap gap-2">{players.map(p => <div key={p.id} className={`px-3 py-1 rounded-full text-sm ${gameState.selectionMethodVotes?.[p.id] ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-400'}`}>{p.name} {gameState.selectionMethodVotes?.[p.id] ? '‚úì' : '...'}</div>)}</div></div>
                        </div>
                    )}

                    {screen === 'customWordVote' && (
                        <div className="min-h-screen bg-gray-900 flex flex-col p-6 pt-12">
                            <div className="text-center mb-6"><h2 className="text-3xl font-bold text-white mb-2">üó≥Ô∏è –í—ã–±–µ—Ä–∏ —Å–ª–æ–≤–æ</h2>{isImpostor ? (<div className="bg-red-900/50 border border-red-500 rounded-xl p-4 mt-4"><p className="text-red-400 font-bold">üïµÔ∏è –¢—ã –®–ü–ò–û–ù!</p><p className="text-red-300 text-sm mt-1">–¢—ã –Ω–µ –≤–∏–¥–∏—à—å —Å–ª–æ–≤–∞. –ì–æ–ª–æ—Å—É–π –∑–∞ –ª—é–±–æ–µ.</p></div>) : <p className="text-gray-400">–°–ª–æ–≤–∞ —à–ø–∏–æ–Ω–æ–≤ –æ—Ç–º–µ—á–µ–Ω—ã üïµÔ∏è</p>}</div>
                            <div className="flex-1">
                                {wordVote === null ? (<div className="space-y-3">{isImpostor ? (civilianWordEntries.map((entry, idx) => (<button key={idx} onClick={() => submitWordVote(idx)} className="w-full bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 px-6 rounded-xl tap-animation border border-gray-700 text-left"><span className="text-gray-500">–°–ª–æ–≤–æ #{idx + 1}</span></button>))) : (allWordEntries.map(([pid, data], idx) => { const isImp = impostorIds.includes(pid); const civIdx = civilianWordEntries.findIndex(([p]) => p === pid); return (<button key={pid} onClick={() => !isImp && submitWordVote(civIdx)} disabled={isImp} className={`w-full font-bold py-4 px-6 rounded-xl tap-animation border text-left flex justify-between items-center ${isImp ? 'bg-red-900/30 border-red-500/50 text-red-300 cursor-not-allowed opacity-60' : 'bg-gray-800 hover:bg-purple-900/50 border-gray-700 hover:border-purple-500 text-white'}`}><span>{data.word}</span><span className="text-sm text-gray-500">{isImp ? 'üïµÔ∏è' : data.playerName}</span></button>); }))}</div>) : (<div className="text-center mt-12"><div className="text-6xl mb-4">‚úÖ</div><h3 className="text-2xl font-bold text-green-400 mb-2">–£—á—Ç–µ–Ω–æ!</h3></div>)}
                            </div>
                            <div className="mt-8 bg-gray-800 rounded-xl p-4"><h3 className="text-sm text-gray-400 uppercase mb-3">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏:</h3><div className="flex flex-wrap gap-2">{players.map(p => <div key={p.id} className={`px-3 py-1 rounded-full text-sm ${gameState.wordVotes?.[p.id] ? 'bg-green-600 text-white' : 'bg-gray-700 text-gray-400'}`}>{p.name} {gameState.wordVotes?.[p.id] ? '‚úì' : '...'}</div>)}</div></div>
                        </div>
                    )}
                    {screen === 'wordSelect' && (
                        <div className="min-h-screen bg-gray-900 flex flex-col p-6 pt-12">
                            <div className="absolute top-0 left-0 w-full h-2 bg-gray-800"><div className="h-full bg-green-500 timer-bar" style={{ width: `${(countdown / 10) * 100}%` }}></div></div>
                            <div className="text-center mb-4 font-mono text-xl text-green-400">–ù–∞—á–∞–ª–æ: {countdown}</div>
                            <div className="flex-1 flex flex-col justify-center items-center text-center">
                                <div className="mb-2 text-gray-400">–í–∞—à–∞ —Ä–æ–ª—å:</div>
                                {myRole === 'impostor' ? <div className="text-5xl font-black text-red-500 mb-8 animate-pulse">üïµÔ∏è –®–ü–ò–û–ù</div> : <div className="text-5xl font-black text-blue-400 mb-8">–ú–ò–†–ù–´–ô</div>}
                                <div className="bg-gray-800 p-8 rounded-3xl w-full shadow-2xl border border-gray-700"><p className="text-gray-400 mb-2 text-sm uppercase">–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ</p>{myRole === 'impostor' ? <div className="text-3xl font-bold text-gray-500 blur-sm select-none">–°–ö–†–´–¢–û</div> : <div className="text-4xl font-bold text-white break-words">{gameState.currentWord}</div>}</div>
                                {gameState.impostorCount > 1 && <div className="mt-4 px-4 py-2 bg-red-900/30 border border-red-500/50 rounded-xl"><span className="text-red-400 text-sm">üïµÔ∏è –®–ø–∏–æ–Ω–æ–≤: {gameState.impostorCount}</span></div>}
                            </div>
                            <div className="mt-8 space-y-4">{myRole === 'impostor' ? <button className="w-full bg-gray-700 text-gray-500 font-bold py-4 rounded-xl cursor-not-allowed flex items-center justify-center gap-2"><Icons.Finger /> –ñ–¥–∏—Ç–µ...</button> : (GAME_DATABASE[gameState.theme]?.isCustom ? <button className="w-full bg-gray-700 text-gray-500 font-bold py-4 rounded-xl cursor-not-allowed flex items-center justify-center gap-2"><Icons.Check /> –°–ª–æ–≤–æ –≤—ã–±—Ä–∞–Ω–æ</button> : <button onClick={changeWord} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 rounded-xl tap-animation flex items-center justify-center gap-2"><Icons.Refresh /> –°–º–µ–Ω–∏—Ç—å</button>)}</div>
                        </div>
                    )}

                    {screen === 'game' && (
                        <div className="min-h-screen bg-gray-900 p-6 flex flex-col pt-16">
                            <div className="text-center mb-6"><div className="inline-block px-4 py-1 rounded-full bg-gray-800 border border-gray-700 text-gray-400 text-sm font-bold uppercase tracking-widest">–¢–ï–ú–ê: {gameState.theme}</div>{gameState.impostorCount > 1 && <div className="inline-block ml-2 px-3 py-1 rounded-full bg-red-900/30 border border-red-500/50 text-red-400 text-xs">üïµÔ∏è {gameState.impostorCount}</div>}</div>
                            {gameState.lastEjected && <div className="bg-red-900/50 border border-red-500/50 p-4 rounded-xl mb-4 text-red-200 text-center animate-bounce">üíÄ <b>{gameState.lastEjected.name}</b> –≤—ã–ª–µ—Ç–µ–ª. –†–æ–ª—å: <b>{gameState.lastEjected.role === 'civilian' ? '–ú–∏—Ä–Ω—ã–π' : '–®–ø–∏–æ–Ω'}</b>.</div>}
                            <div className="flex-1 flex flex-col items-center justify-center">
                                {gameState.bets && Object.keys(gameState.bets).length > 0 && (<div className="w-full max-w-sm mb-6 bg-gray-800/50 p-3 rounded-xl border border-white/10"><h3 className="text-xs text-gray-400 uppercase mb-2 text-center">–ü–æ–¥–æ–∑—Ä–µ–Ω–∏—è:</h3><div className="flex flex-wrap justify-center gap-2">{Object.entries(gameState.bets).map(([bettorId, targetId]) => <div key={bettorId} className="text-xs bg-pink-900/50 border border-pink-500/30 px-2 py-1 rounded">{players.find(p => p.id === bettorId)?.name} ‚ûù {players.find(p => p.id === targetId)?.name}</div>)}</div></div>)}
                                <div className="text-center space-y-4"><div className="p-6 bg-gray-800 rounded-full inline-block mb-4 shadow-lg shadow-purple-500/20"><div className="text-6xl">ü§´</div></div><h2 className="text-3xl font-bold text-white">–ò–≥—Ä–∞ –∏–¥–µ—Ç!</h2><div className="flex flex-col gap-3 mt-4 w-full max-w-xs">{myRole === 'civilian' && <button onClick={() => alert(`–°–ª–æ–≤–æ: ${gameState.currentWord}`)} className="flex items-center justify-center gap-2 bg-blue-900/40 text-blue-300 px-6 py-3 rounded-xl border border-blue-700/50 hover:bg-blue-900/60 transition-colors"><Icons.Eye /> –ù–∞–ø–æ–º–Ω–∏—Ç—å</button>}{!isDead && <button onClick={() => setShowBetModal(true)} className="flex items-center justify-center gap-2 bg-pink-900/40 text-pink-300 px-6 py-3 rounded-xl border border-pink-700/50 hover:bg-pink-900/60 transition-colors"><Icons.Target /> –°—Ç–∞–≤–∫–∞</button>}{myRole === 'impostor' && !isDead && <button onClick={() => setShowGuessModal(true)} className="flex items-center justify-center gap-2 bg-yellow-600 text-black font-bold px-6 py-4 rounded-xl hover:bg-yellow-500 tap-animation shadow-lg shadow-yellow-900/50 animate-pulse mt-2"><Icons.Spy /> –Ø –∑–Ω–∞—é —Å–ª–æ–≤–æ!</button>}</div></div>
                            </div>
                            {!isDead ? (<button onClick={callVote} disabled={meetingCooldown > 0} className={`mt-auto w-full font-bold py-6 rounded-2xl flex items-center justify-center gap-3 uppercase tracking-widest text-lg shadow-lg transition-all ${meetingCooldown > 0 ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-red-600 hover:bg-red-700 text-white tap-animation shadow-red-900/50'}`}>{meetingCooldown > 0 ? <><Icons.Lock /> {meetingCooldown}—Å...</> : <><Icons.Finger /> –°–æ–±—Ä–∞–Ω–∏–µ</>}</button>) : <div className="text-center text-gray-500 py-4 bg-gray-800 rounded-xl mt-4">üëª –í—ã –ø—Ä–∏–∑—Ä–∞–∫</div>}
                        </div>
                    )}
                    {screen === 'voting' && (
                        <div className="min-h-screen bg-gray-900 p-6 pt-16">
                            <h2 className="text-3xl font-bold text-white text-center mb-2">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h2>
                            <p className="text-gray-400 text-center mb-8">–ö—Ç–æ —à–ø–∏–æ–Ω?</p>
                            <div className="grid grid-cols-2 gap-4">
                                {players.map(p => {
                                    const pDead = gameState.players?.[p.id]?.isDead;
                                    const isSelected = voteTarget === p.id;
                                    const votersForThisPlayer = Object.entries(gameState.votes || {}).filter(([, tid]) => tid === p.id).map(([vid]) => players.find(pl => pl.id === vid)?.name);
                                    return (<button key={p.id} onClick={() => submitVote(p.id)} disabled={isDead || voteTarget || pDead} className={`p-4 rounded-xl text-left transition-all border-2 relative ${pDead ? 'bg-red-900/20 border-red-900 opacity-50 cursor-not-allowed' : 'bg-gray-800 border-green-500/30 hover:border-green-500'} ${isSelected ? 'bg-green-600 border-green-400' : ''} ${!pDead && !isSelected ? 'text-green-400' : 'text-gray-300'}`}><div className="text-2xl mb-2">{pDead ? 'üíÄ' : 'üôÇ'}</div><div className={`font-bold truncate ${pDead ? 'text-red-400' : ''}`}>{p.name}</div><div className="flex flex-wrap gap-1 mt-2">{votersForThisPlayer.map((vName, idx) => <span key={idx} className="text-[10px] bg-white/20 text-white px-1.5 py-0.5 rounded">{vName}</span>)}</div>{voteTarget === p.id && <div className="text-xs text-white/80 mt-1 absolute top-2 right-2">‚úî</div>}</button>);
                                })}
                            </div>
                            {isHost && <button onClick={cancelVote} className="mt-8 w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-4 rounded-xl tap-animation flex items-center justify-center gap-2"><Icons.Back /> –û—Ç–º–µ–Ω–∞</button>}
                            {isDead && <div className="text-center mt-8 text-gray-500">–ü—Ä–∏–∑—Ä–∞–∫–∏ –Ω–µ –≥–æ–ª–æ—Å—É—é—Ç üò∂</div>}
                        </div>
                    )}

                    {screen === 'gameOver' && (
                        <div className={`min-h-screen flex flex-col items-center justify-center p-6 ${gameState.winner === 'civilians' ? 'bg-blue-900' : 'bg-red-900'}`}>
                            <div className="text-8xl mb-4">{gameState.winner === 'civilians' ? 'üëÆ‚Äç‚ôÇÔ∏è' : 'üïµÔ∏è'}</div>
                            <h1 className="text-4xl font-black text-white mb-2 uppercase text-center">{gameState.winner === 'civilians' ? '–ú–∏—Ä–Ω—ã–µ –ø–æ–±–µ–¥–∏–ª–∏!' : '–®–ø–∏–æ–Ω –ø–æ–±–µ–¥–∏–ª!'}</h1>
                            {gameState.endReason === 'spy_guessed' && <div className="text-yellow-400 font-bold mb-4 uppercase tracking-widest">–®–ø–∏–æ–Ω —É–≥–∞–¥–∞–ª!</div>}
                            {gameState.endReason === 'spy_failed_guess' && <div className="text-red-300 font-bold mb-4 uppercase tracking-widest">–®–ø–∏–æ–Ω –æ—à–∏–±—Å—è!</div>}
                            <div className="bg-black/30 p-6 rounded-2xl mb-8 w-full max-w-sm backdrop-blur-sm border border-white/10">
                                <p className="text-white/70 mb-1">–®–ø–∏–æ–Ω{gameState.impostorCount > 1 ? '—ã' : ''}:</p>
                                <p className="text-3xl font-bold text-white mb-4">{(gameState.impostorIds || [gameState.impostorId]).map(id => players.find(p => p.id === id)?.name).filter(Boolean).join(', ') || '?'}</p>
                                <div className="h-px bg-white/20 w-full mb-4"></div>
                                <p className="text-white/70 mb-1">–°–ª–æ–≤–æ:</p>
                                <p className="text-2xl font-bold text-white">{gameState.currentWord}</p>
                            </div>
                            {isHost && <button onClick={playAgain} className="w-full max-w-xs bg-white text-gray-900 hover:bg-gray-200 font-bold py-4 px-12 rounded-xl tap-animation shadow-lg">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>}
                            {!isHost && <div className="text-white/50 animate-pulse">–û–∂–∏–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞...</div>}
                        </div>
                    )}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ImpostorGame />);
    </script>
</body>
</html>
