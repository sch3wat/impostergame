<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üïµÔ∏è –ò–≥—Ä–∞ –ò–º–ø–æ—Å—Ç–µ—Ä: Premium</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script> <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; overflow-x: hidden; font-family: 'Montserrat', sans-serif; background-color: #0b0b15; color: white; }
        #root { min-height: 100vh; background: radial-gradient(circle at 50% 0%, #2d1b4e 0%, #0b0b15 70%); }
        
        /* UX Animation */
        .tap-scale:active { transform: scale(0.96); transition: transform 0.1s; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        .neon-text { text-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 20px rgba(168, 85, 247, 0.3); }
        
        /* Intro Particles */
        .particle { position: absolute; background: linear-gradient(to top, #a855f7, #ec4899); border-radius: 50%; opacity: 0.3; animation: rise 10s infinite linear; }
        @keyframes rise { 0% { transform: translateY(110vh) scale(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-10vh) scale(1); opacity: 0; } }

        /* Specific Animations */
        @keyframes scanline { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .scan-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, rgba(168, 85, 247, 0.1), transparent); animation: scanline 3s linear infinite; pointer-events: none; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .floating { animation: float 3s ease-in-out infinite; }
        
        @keyframes revealWord { 0% { filter: blur(10px); opacity: 0; letter-spacing: 10px; } 100% { filter: blur(0); opacity: 1; letter-spacing: normal; } }
        .word-reveal { animation: revealWord 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        /* Inputs & Selects */
        .custom-input { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; }
        .custom-input:focus { border-color: #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); outline: none; }
        select { -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }

        /* Animations from prev versions */
        @keyframes confetti { 0% { transform: translateY(-100vh) rotate(0deg); } 100% { transform: translateY(100vh) rotate(720deg); } }
        .confetti-piece { position: fixed; width: 8px; height: 8px; animation: confetti 4s linear forwards; }
        
        @keyframes dartFly { 0% { transform: translate(-200px, -200px) rotate(-45deg) scale(2); opacity: 0; } 50% { opacity: 1; } 100% { transform: translate(0, 0) rotate(0deg) scale(1); } }
        .dart-fly { animation: dartFly 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        
        @keyframes wheel { 0% { transform: rotate(0deg); } 100% { transform: rotate(var(--rot)); } }
        .wheel-anim { animation: wheel 4s cubic-bezier(0.1, 0, 0.1, 1) forwards; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ –ë–õ–û–ö –ù–ê –°–í–û–ò –ö–õ–Æ–ß–ò ---
        const firebaseConfig = {
            apiKey: "–í–°–¢–ê–í–¨–¢–ï_–°–í–û–ô_API_KEY_–°–Æ–î–ê",
            authDomain: "–í–ê–®_–ü–†–û–ï–ö–¢.firebaseapp.com",
            databaseURL: "https://–í–ê–®_–ü–†–û–ï–ö–¢-default-rtdb.firebaseio.com",
            projectId: "–í–ê–®_–ü–†–û–ï–ö–¢",
            storageBucket: "–í–ê–®_–ü–†–û–ï–ö–¢.appspot.com",
            messagingSenderId: "–í–ê–®_ID",
            appId: "–í–ê–®_APP_ID"
        };
        // ------------------------------------------------

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Auth

        // --- CONSTANTS ---
        const BETA_MODE = true;
        const BOT_NAMES = ['–ö–∏–±–µ—Ä-–û–ª–µ–≥ ü§ñ', '–ù–µ–π—Ä–æ-–ê–Ω—è ü§ñ', 'T-800 ü§ñ', '–í–∞–ª–ª-–ò ü§ñ', '–ì–õ–∞–î–û–° ü§ñ', '–î–∂–∞—Ä–≤–∏—Å ü§ñ'];
        
        // --- ICONS ---
        const Icons = {
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            Crown: () => <svg className="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
            Refresh: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
        };

        // --- GAME DATABASE ---
        const GAME_DATABASE = {
            '–ñ–∏–≤–æ—Ç–Ω—ã–µ': { easy: ['–°–æ–±–∞–∫–∞','–ö–æ—à–∫–∞','–í–æ–ª–∫','–õ–∏—Å–∞','–ú–µ–¥–≤–µ–¥—å','–ó–∞—è—Ü','–¢–∏–≥—Ä','–õ–µ–≤','–°–ª–æ–Ω','–ñ–∏—Ä–∞—Ñ','–ï–Ω–æ—Ç','–ë–µ–≥–µ–º–æ—Ç','–ù–æ—Å–æ—Ä–æ–≥','–ë–æ–±—Ä','–ö—Ä—ã—Å–∞'], medium: ['–£—Ç–∫–æ–Ω–æ—Å','–õ–µ–Ω–∏–≤–µ—Ü','–ë—Ä–æ–Ω–µ–Ω–æ—Å–µ—Ü','–ú—É—Ä–∞–≤—å–µ–¥','–ê–∫—Å–æ–ª–æ—Ç–ª—å','–ö–∞–ø–∏–±–∞—Ä–∞','–ú–∞–Ω—É–ª','–¢–∞–ø–∏—Ä','–ù–∞—Ä–≤–∞–ª','–û—Å—å–º–∏–Ω–æ–≥'], hard: ['–í—ã—Ö—É—Ö–æ–ª—å','–ì–∞—Ç—Ç–µ—Ä–∏—è','–¢—Ä—É–±–∫–æ–∑—É–±','–°–∏—Ñ–∞–∫–∞','–ö–≤–æ–∫–∫–∞'] },
            '–ï–¥–∞': { easy: ['–•–ª–µ–±','–Ø–±–ª–æ–∫–æ','–ë–∞–Ω–∞–Ω','–ü–∏—Ü—Ü–∞','–ë—É—Ä–≥–µ—Ä','–°—É—à–∏','–¢–æ—Ä—Ç','–ú–æ—Ä–æ–∂–µ–Ω–æ–µ','–®–æ–∫–æ–ª–∞–¥','–ê—Ä–±—É–∑','–û–≥—É—Ä–µ—Ü'], medium: ['–ë–æ—Ä—â','–ü–µ–ª—å–º–µ–Ω–∏','–®–∞—à–ª—ã–∫','–ü–ª–æ–≤','–õ–∞–∑–∞–Ω—å—è','–ë–ª–∏–Ω—ã','–û–ª–∏–≤—å–µ','–®–∞—É—Ä–º–∞','–¢–∏—Ä–∞–º–∏—Å—É','–ß–∏–∑–∫–µ–π–∫'], hard: ['–§—É–∞-–≥—Ä–∞','–¢—Ä—é—Ñ–µ–ª—å','–£—Å—Ç—Ä–∏—Ü—ã','–§–æ–Ω–¥—é','–ü–∞—ç–ª—å—è','–†–∏–∑–æ—Ç—Ç–æ','–¢–æ–º –Ø–º','–•–∞–º–æ–Ω'] },
            '–ú–µ—Å—Ç–∞': { easy: ['–î–æ–º','–®–∫–æ–ª–∞','–ë–æ–ª—å–Ω–∏—Ü–∞','–ü–ª—è–∂','–õ–µ—Å','–ì–æ—Ä—ã','–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä','–ú–∞–≥–∞–∑–∏–Ω','–ü–∞—Ä–∫','–ö–∞—Ñ–µ'], medium: ['–ê—ç—Ä–æ–ø–æ—Ä—Ç','–í–æ–∫–∑–∞–ª','–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞','–ú—É–∑–µ–π','–°—Ç–∞–¥–∏–æ–Ω','–¶–∏—Ä–∫','–ó–æ–æ–ø–∞—Ä–∫','–°–∞—É–Ω–∞','–ö–ª–∞–¥–±–∏—â–µ'], hard: ['–ú–ö–°','–ü–æ–¥–≤–æ–¥–Ω–∞—è –ª–æ–¥–∫–∞','–ë—É–Ω–∫–µ—Ä','–ú–æ—Ä–≥','–ü—Å–∏—Ö—É—à–∫–∞','–¢—é—Ä—å–º–∞','–ß–µ—Ä–Ω–æ–±—ã–ª—å'] },
            '18+': { easy: ['–ö—Ä–æ–≤–∞—Ç—å','–î—É—à','–ü—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤','–ü–æ—Ü–µ–ª—É–π','–õ–∏—Ñ—á–∏–∫','–°—Ç—Ä–∏–ø—Ç–∏–∑','–ë–∞–Ω—è','–ú–∞—Å—Å–∞–∂'], medium: ['–ù–∞—Ä—É—á–Ω–∏–∫–∏','–ü–ª–µ—Ç–∫–∞','–°–µ–∫—Å-—à–æ–ø','–í–∏–±—Ä–∞—Ç–æ—Ä','–ö–∞–º–∞—Å—É—Ç—Ä–∞','–†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã','–≠—Å–∫–æ—Ä—Ç'], hard: ['–°–≤–∏–Ω–≥–µ—Ä—ã','–ì—Ä—É–ø–ø–æ–≤—É—Ö–∞','–ë–î–°–ú','–§–µ—Ç–∏—à','–®–∏–±–∞—Ä–∏','–§–∏—Å—Ç–∏–Ω–≥','–ì–ª–æ—Ä–∏—Ö–æ–ª'] },
            '–°–≤–æ—ë —Å–ª–æ–≤–æ': { isCustom: true, easy: [], medium: [], hard: [] }
        };
        const BOT_WORDS = ['–°–æ–ª–Ω—Ü–µ', '–ö–æ—Å–º–æ—Å', '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç', '–õ—é–±–æ–≤—å', '–†–æ–±–æ—Ç', '–ë–∏—Ç–∫–æ–∏–Ω', '–ü–∏–≤–æ', '–î–∂–æ–∫–µ—Ä'];

        // --- COMPONENTS ---

        // 1. INTRO
        const Intro = ({ onEnd }) => {
            const [text, setText] = useState('');
            const fullText = "IMPOSTOR";
            
            useEffect(() => {
                let i = 0;
                const t = setInterval(() => {
                    setText(fullText.slice(0, i+1));
                    i++;
                    if(i === fullText.length) {
                        clearInterval(t);
                        setTimeout(onEnd, 2000);
                    }
                }, 150);
                return () => clearInterval(t);
            }, []);

            return (
                <div className="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center overflow-hidden">
                    <div className="absolute inset-0 opacity-30">
                        {Array.from({length: 20}).map((_,i) => (
                            <div key={i} className="particle" style={{ left: Math.random()*100+'%', animationDelay: Math.random()*5+'s', width: Math.random()*10+5+'px', height: Math.random()*10+5+'px' }}/>
                        ))}
                    </div>
                    <div className="relative z-10 text-center">
                        <div className="text-9xl mb-6 floating filter drop-shadow-[0_0_30px_rgba(168,85,247,0.6)]">üïµÔ∏è</div>
                        <h1 className="text-6xl font-black tracking-widest bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 neon-text min-h-[80px]">
                            {text}
                        </h1>
                        <p className="text-gray-500 tracking-[0.5em] text-xs mt-4 uppercase animate-pulse">Detect or Deceive</p>
                    </div>
                </div>
            );
        };

        // 2. MAIN APP
        const App = () => {
            const [showIntro, setShowIntro] = useState(true);
            const [view, setView] = useState('auth'); // auth, lobby, game
            const [user, setUser] = useState(null);
            
            // Game Data
            const [roomCode, setRoomCode] = useState('');
            const [playerName, setPlayerName] = useState('');
            const [players, setPlayers] = useState([]);
            const [isHost, setIsHost] = useState(false);
            const [gameState, setGameState] = useState({});
            
            // Local UI States
            const [settings, setSettings] = useState({ theme: '–ñ–∏–≤–æ—Ç–Ω—ã–µ', difficulty: 'medium', impCount: 1 });
            const [customWord, setCustomWord] = useState('');
            const [hasSubmittedWord, setHasSubmittedWord] = useState(false);
            const [voteMethod, setVoteMethod] = useState(null); // 'random' or 'vote'
            const [dartWords, setDartWords] = useState(null);
            
            // AUTH HANDLER (THE FIX)
            useEffect(() => {
                const unsub = auth.onAuthStateChanged((u) => {
                    if (u) {
                        setUser(u);
                        // –ï—Å–ª–∏ –º—ã —É–∂–µ –±—ã–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    } else {
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –∞–Ω–æ–Ω–∏–º–æ–º
                        auth.signInAnonymously().catch(e => alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + e.message));
                    }
                });
                return () => unsub();
            }, []);

            // ROOM LISTENER
            useEffect(() => {
                if (roomCode && user) {
                    const ref = database.ref(`rooms/${roomCode}`);
                    ref.on('value', snap => {
                        const val = snap.val();
                        if (val) {
                            if (val.players) setPlayers(Object.values(val.players));
                            if (val.host === user.uid) setIsHost(true);
                            if (val.game) setGameState(val.game);
                            
                            // Navigation logic based on phase
                            if (val.game.phase === 'LOBBY') setView('lobby');
                            else setView('game');
                        } else {
                            // Room deleted or doesn't exist
                            if (view !== 'auth') setView('auth');
                        }
                    });
                    return () => ref.off();
                }
            }, [roomCode, user, view]);

            // ACTIONS
            const createRoom = async () => {
                if (!playerName) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                const code = Math.floor(1000 + Math.random() * 9000).toString();
                const uid = user.uid;
                
                await database.ref(`rooms/${code}`).set({
                    host: uid,
                    created: Date.now(),
                    players: { [uid]: { id: uid, name: playerName, isDead: false, score: 0 } },
                    game: { phase: 'LOBBY' }
                });
                setRoomCode(code);
                setPlayerName(playerName);
            };

            const joinRoom = async () => {
                if (!playerName || !roomCode) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');
                const ref = database.ref(`rooms/${roomCode}`);
                const snap = await ref.once('value');
                if (!snap.exists()) return alert('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                
                // Add player
                await ref.child(`players/${user.uid}`).set({ id: user.uid, name: playerName, isDead: false, score: 0 });
                setPlayerName(playerName);
            };

            const addBot = async () => {
                if (!isHost) return;
                const name = BOT_NAMES.find(n => !players.some(p => p.name === n)) || 'Bot-' + Math.floor(Math.random()*100);
                const botId = 'bot_' + Date.now();
                await database.ref(`rooms/${roomCode}/players/${botId}`).set({ id: botId, name, isBot: true, isDead: false });
            };

            const startGame = async () => {
                if (players.length < 3 && !BETA_MODE) return alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞');
                
                const isCustom = GAME_DATABASE[settings.theme].isCustom;
                const phase = isCustom ? 'CUSTOM_INPUT' : 'ROLE_REVEAL';
                
                let word = '';
                if (!isCustom) {
                    const pool = GAME_DATABASE[settings.theme][settings.difficulty] || GAME_DATABASE[settings.theme].easy;
                    word = pool[Math.floor(Math.random() * pool.length)];
                }

                // Roles
                const pList = [...players].sort(() => Math.random() - 0.5);
                const impCount = Math.min(settings.impCount, Math.floor(players.length / 2));
                const impIds = pList.slice(0, impCount).map(p => p.id);
                
                // Reset players state
                const updates = {};
                players.forEach(p => {
                    updates[`players/${p.id}/role`] = impIds.includes(p.id) ? 'impostor' : 'civilian';
                    updates[`players/${p.id}/isDead`] = false;
                });

                await database.ref(`rooms/${roomCode}/game`).set({
                    phase,
                    theme: settings.theme,
                    currentWord: word,
                    impostorIds: impIds,
                    roundStart: Date.now()
                });
                await database.ref(`rooms/${roomCode}`).update(updates);
                
                // Bot Logic for Custom Words
                if (isCustom && BETA_MODE) {
                    players.filter(p => p.isBot).forEach(b => {
                        const w = BOT_WORDS[Math.floor(Math.random() * BOT_WORDS.length)];
                        database.ref(`rooms/${roomCode}/game/customWords/${b.id}`).set({ word: w, author: b.name });
                    });
                }
            };

            const sendCustomWord = async () => {
                if(!customWord.trim()) return;
                await database.ref(`rooms/${roomCode}/game/customWords/${user.uid}`).set({ word: customWord, author: playerName });
                setHasSubmittedWord(true);
                
                // Host check all submitted
                if (isHost) {
                    // Simple check via timeout or listener (simplified here)
                }
            };
            
            // Check custom words completion (HOST ONLY)
            useEffect(() => {
                if (!isHost || gameState.phase !== 'CUSTOM_INPUT') return;
                const ref = database.ref(`rooms/${roomCode}/game/customWords`);
                const listener = ref.on('value', s => {
                    const words = s.val() || {};
                    if (Object.keys(words).length >= players.length) {
                         // Decide Selection Method (Random for now to simplify UI)
                         const entries = Object.entries(words);
                         // Filter out Impostor words if you want (Optional rule). Let's keep all.
                         const target = entries[Math.floor(Math.random() * entries.length)];
                         
                         // Trigger DART Animation
                         database.ref(`rooms/${roomCode}/game`).update({ 
                             phase: 'DART_SPIN',
                             dartWords: entries.map(e => ({id: e[0], word: e[1].word, author: e[1].author})),
                             spinResult: target[1].word
                         });
                         
                         setTimeout(() => {
                             database.ref(`rooms/${roomCode}/game`).update({ phase: 'ROLE_REVEAL', currentWord: target[1].word });
                         }, 6000); // Wait for anim
                    }
                });
                return () => ref.off();
            }, [isHost, gameState.phase, players.length]);


            // --- RENDERERS ---

            if (showIntro) return <Intro onEnd={() => setShowIntro(false)} />;

            if (view === 'auth') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen p-6 relative overflow-hidden">
                        <div className="scan-overlay"></div>
                        <div className="z-10 w-full max-w-md space-y-8 glass-panel p-8 rounded-3xl">
                            <div className="text-center">
                                <h1 className="text-5xl font-black bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500 mb-2">IMPOSTOR</h1>
                                <p className="text-gray-400 text-sm tracking-widest uppercase">Premium Edition</p>
                            </div>

                            <div className="space-y-4">
                                <input 
                                    value={playerName} 
                                    onChange={e => setPlayerName(e.target.value)} 
                                    placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º"
                                    className="w-full bg-black/40 text-white p-4 rounded-xl custom-input text-center text-lg font-bold placeholder-gray-600"
                                />
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-2">
                                        <button onClick={createRoom} className="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-bold tap-scale shadow-lg shadow-purple-900/40">
                                            –°–æ–∑–¥–∞—Ç—å
                                        </button>
                                    </div>
                                    <div className="space-y-2">
                                        <input 
                                            value={roomCode}
                                            onChange={e => setRoomCode(e.target.value)}
                                            placeholder="–ö–æ–¥"
                                            className="w-full bg-black/40 text-white p-4 rounded-xl custom-input text-center font-mono"
                                            maxLength={4}
                                        />
                                        <button onClick={joinRoom} className="w-full py-4 bg-gray-800 hover:bg-gray-700 rounded-xl font-bold tap-scale border border-gray-600">
                                            –í–æ–π—Ç–∏
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'lobby') {
                return (
                    <div className="min-h-screen p-6 flex flex-col relative">
                        {/* Header */}
                        <div className="flex justify-between items-center mb-8 glass-panel p-4 rounded-2xl">
                            <div>
                                <div className="text-gray-400 text-xs uppercase tracking-wider">–ö–æ–º–Ω–∞—Ç–∞</div>
                                <div className="text-3xl font-mono font-black text-purple-400">{roomCode}</div>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span className="text-sm font-bold text-gray-300">{players.length} online</span>
                            </div>
                        </div>

                        {/* Players Grid */}
                        <div className="flex-1 grid grid-cols-2 gap-3 content-start mb-8">
                            {players.map(p => (
                                <div key={p.id} className="bg-gray-800/60 p-4 rounded-2xl border border-gray-700 flex items-center gap-3 relative overflow-hidden">
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-xl">
                                        {p.isBot ? 'ü§ñ' : 'üòé'}
                                    </div>
                                    <div className="truncate font-bold text-sm text-gray-200">{p.name}</div>
                                    {p.id === gameState.host && <div className="absolute top-1 right-1"><Icons.Crown/></div>}
                                </div>
                            ))}
                            {isHost && (
                                <button onClick={addBot} className="bg-gray-800/30 p-4 rounded-2xl border border-gray-700 border-dashed flex flex-col items-center justify-center text-gray-500 hover:text-purple-400 tap-scale">
                                    <span className="text-2xl mb-1">+</span>
                                    <span className="text-xs font-bold uppercase">–ë–æ—Ç</span>
                                </button>
                            )}
                        </div>

                        {/* Settings & Start (Host Only) */}
                        {isHost ? (
                            <div className="glass-panel p-6 rounded-t-3xl -mx-6 -mb-6 space-y-4">
                                <div className="flex gap-3">
                                    <div className="flex-1">
                                        <label className="text-xs text-gray-500 uppercase ml-1">–¢–µ–º–∞</label>
                                        <select 
                                            value={settings.theme}
                                            onChange={e => setSettings({...settings, theme: e.target.value})}
                                            className="w-full bg-black/40 p-3 rounded-xl border border-gray-600 text-sm font-bold mt-1"
                                        >
                                            {Object.keys(GAME_DATABASE).map(t => <option key={t} value={t}>{t}</option>)}
                                        </select>
                                    </div>
                                    {!GAME_DATABASE[settings.theme].isCustom && (
                                        <div className="w-1/3">
                                            <label className="text-xs text-gray-500 uppercase ml-1">–°–ª–æ–∂–Ω.</label>
                                            <select 
                                                value={settings.difficulty}
                                                onChange={e => setSettings({...settings, difficulty: e.target.value})}
                                                className="w-full bg-black/40 p-3 rounded-xl border border-gray-600 text-sm font-bold mt-1"
                                            >
                                                <option value="easy">Easy</option><option value="medium">Mid</option><option value="hard">Hard</option>
                                            </select>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="flex items-center justify-between bg-black/20 p-3 rounded-xl">
                                    <span className="text-sm font-bold text-gray-400">–ö–æ–ª-–≤–æ —à–ø–∏–æ–Ω–æ–≤</span>
                                    <div className="flex gap-1">
                                        {[1,2,3].map(n => (
                                            <button 
                                                key={n} 
                                                onClick={() => setSettings({...settings, impCount: n})}
                                                disabled={n > Math.floor(players.length/2)}
                                                className={`w-8 h-8 rounded-lg font-bold text-sm ${settings.impCount === n ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-500'}`}
                                            >
                                                {n}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={startGame} className="w-full py-5 bg-white text-black rounded-2xl font-black text-xl tracking-widest shadow-[0_0_20px_rgba(255,255,255,0.3)] tap-scale">
                                    START GAME
                                </button>
                            </div>
                        ) : (
                            <div className="text-center pb-8 animate-pulse text-gray-500 font-mono">
                                –û–ñ–ò–î–ê–ù–ò–ï –•–û–°–¢–ê...
                            </div>
                        )}
                    </div>
                );
            }

            // GAME VIEW HANDLER
            if (view === 'game') {
                const myRole = players.find(p => p.id === user.uid)?.role;
                const phase = gameState.phase;

                // 1. CUSTOM INPUT
                if (phase === 'CUSTOM_INPUT') {
                    return (
                        <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-black">
                            <h2 className="text-3xl font-bold mb-2 neon-text">–ù–∞–ø–∏—à–∏ —Å–ª–æ–≤–æ</h2>
                            <p className="text-gray-500 mb-8 text-sm">–ü—Ä–∏–¥—É–º–∞–π —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ</p>
                            
                            {!hasSubmittedWord ? (
                                <div className="w-full max-w-sm space-y-4">
                                    <input autoFocus className="w-full bg-gray-900 p-6 rounded-2xl text-center text-2xl text-white border-2 border-purple-500 focus:border-pink-500 outline-none" 
                                        value={customWord} onChange={e => setCustomWord(e.target.value)} placeholder="..." />
                                    <button onClick={sendCustomWord} className="w-full py-4 bg-purple-600 rounded-xl font-bold tap-scale">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                </div>
                            ) : (
                                <div className="text-center">
                                    <div className="text-6xl mb-4 animate-bounce">‚úÖ</div>
                                    <p className="text-green-400 font-bold">–ü—Ä–∏–Ω—è—Ç–æ</p>
                                </div>
                            )}
                            {/* Progress Dots */}
                            <div className="mt-10 flex gap-2">
                                {players.map(p => (
                                    <div key={p.id} className={`w-3 h-3 rounded-full transition-all ${gameState.customWords?.[p.id] ? 'bg-green-500 scale-125' : 'bg-gray-800'}`} />
                                ))}
                            </div>
                        </div>
                    );
                }

                // 2. DART ANIMATION
                if (phase === 'DART_SPIN') {
                    return (
                        <div className="min-h-screen flex items-center justify-center bg-black overflow-hidden relative">
                             <div className="absolute inset-0 flex items-center justify-center">
                                 {/* Simplified Visual Wheel */}
                                 <div className="w-80 h-80 rounded-full border-4 border-purple-500 relative wheel-anim flex items-center justify-center" style={{'--rot': '1080deg'}}>
                                    <span className="text-4xl">üé°</span>
                                 </div>
                             </div>
                             <div className="z-10 bg-black/80 backdrop-blur p-6 rounded-2xl text-center">
                                 <h2 className="text-2xl font-bold text-white mb-2">–í—ã–±–æ—Ä —Å–ª–æ–≤–∞...</h2>
                                 <div className="text-purple-400 font-mono animate-pulse">–ö—Ä—É—Ç–∏–º —Ä—É–ª–µ—Ç–∫—É</div>
                             </div>
                        </div>
                    );
                }

                // 3. ROLE & WORD REVEAL (Playing)
                if (phase === 'ROLE_REVEAL' || phase === 'PLAYING') {
                    const isImp = myRole === 'impostor';
                    return (
                        <div className="min-h-screen flex flex-col p-6 relative overflow-hidden">
                             {/* Ambient Background based on role */}
                             <div className={`absolute inset-0 opacity-20 ${isImp ? 'bg-red-900' : 'bg-blue-900'}`} />
                             
                             <div className="relative z-10 flex-1 flex flex-col items-center justify-center text-center">
                                 <div className="mb-2 text-gray-400 text-sm tracking-widest uppercase">–í–∞—à–∞ —Ä–æ–ª—å</div>
                                 <h1 className={`text-5xl font-black mb-10 tracking-wider ${isImp ? 'text-red-500 drop-shadow-[0_0_20px_rgba(239,68,68,0.6)]' : 'text-blue-400 drop-shadow-[0_0_20px_rgba(96,165,250,0.6)]'}`}>
                                     {isImp ? '–®–ü–ò–û–ù' : '–ú–ò–†–ù–´–ô'}
                                 </h1>
                                 
                                 <div className="glass-panel p-8 rounded-3xl w-full max-w-xs relative overflow-hidden group">
                                     <div className="text-xs text-gray-500 uppercase mb-2">–°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ</div>
                                     <div className={`text-3xl font-bold break-words ${isImp ? 'blur-sm select-none opacity-50' : 'word-reveal'}`}>
                                         {isImp ? '–ù–ï–ò–ó–í–ï–°–¢–ù–û' : gameState.currentWord}
                                     </div>
                                     {isImp && <div className="absolute inset-0 flex items-center justify-center text-red-500/30 font-black text-6xl -rotate-12 pointer-events-none">???</div>}
                                 </div>

                                 {/* Spy Info */}
                                 {isImp && gameState.impostorIds.length > 1 && (
                                     <div className="mt-6 bg-red-900/30 border border-red-500/30 p-3 rounded-xl">
                                         <div className="text-xs text-red-300 mb-1">–°–æ—é–∑–Ω–∏–∫–∏:</div>
                                         <div className="font-bold">{players.filter(p => gameState.impostorIds.includes(p.id) && p.id !== user.uid).map(p => p.name).join(', ')}</div>
                                     </div>
                                 )}
                             </div>
                             
                             {/* Controls */}
                             <div className="relative z-10 pb-6 space-y-3">
                                 <button className="w-full py-6 bg-white text-black font-black text-xl rounded-2xl uppercase tracking-widest shadow-lg active:scale-95 transition-transform"
                                     onClick={() => alert("–§—É–Ω–∫—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç–µ—Å—å –≤ —á–∞—Ç–µ!)")}
                                 >
                                     –ì–æ–ª–æ—Å–æ–≤–∞—Ç—å
                                 </button>
                                 {isHost && (
                                     <button onClick={() => database.ref(`rooms/${roomCode}/game`).update({phase:'LOBBY'})} className="w-full py-4 bg-gray-800 font-bold rounded-xl text-gray-400">
                                         –í –ª–æ–±–±–∏
                                     </button>
                                 )}
                             </div>
                        </div>
                    );
                }

                return null;
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
